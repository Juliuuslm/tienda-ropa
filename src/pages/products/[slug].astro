---
import BaseLayout from '@/layouts/BaseLayout.astro';
import Image from '@/components/common/Image.astro';
import Button from '@/components/common/Button.astro';
import products from '@/data/products.json';

const { slug } = Astro.params;
const product = products.find((p) => p.slug === slug);

if (!product) {
  return Astro.redirect('/404');
}

export async function getStaticPaths() {
  return products.map((product) => ({
    params: { slug: product.slug },
    props: { product },
  }));
}
---

<BaseLayout
  title={product.name}
  description={product.description}
  image={product.image}
  type="product"
>
  <!-- Breadcrumb -->
  <nav class="bg-neutral-50 py-4">
    <div class="container flex gap-2 text-sm">
      <a href="/" class="text-primary-600 hover:underline">Home</a>
      <span>/</span>
      <a href="/shop" class="text-primary-600 hover:underline">Shop</a>
      <span>/</span>
      <span class="text-neutral-600">{product.name}</span>
    </div>
  </nav>

  <!-- Product Section -->
  <section class="py-12">
    <div class="container">
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-12">
        <!-- Product Images -->
        <div>
          <Image
            src={product.image}
            alt={product.name}
            class="w-full rounded-lg mb-4"
          />
          <div class="grid grid-cols-4 gap-4">
            {product.images.map((img) => (
              <Image
                src={img}
                alt={product.name}
                class="w-full rounded cursor-pointer hover:opacity-75"
              />
            ))}
          </div>
        </div>

        <!-- Product Info -->
        <div>
          <!-- Title -->
          <h1 class="text-4xl font-bold mb-4">{product.name}</h1>

          <!-- Rating -->
          <div class="flex items-center gap-4 mb-6">
            <div class="flex gap-1">
              {[...Array(5)].map((_, i) => (
                <span
                  class={`text-2xl ${
                    i < Math.round(product.rating) ? 'text-yellow-400' : 'text-neutral-300'
                  }`}
                >
                  ★
                </span>
              ))}
            </div>
            <span class="text-neutral-600">({product.reviews} reseñas)</span>
          </div>

          <!-- Price -->
          <div class="mb-6">
            <div class="flex items-center gap-3 mb-2">
              <span class="text-3xl font-bold text-primary-600">
                ${(product.salePrice || product.price).toFixed(2)}
              </span>
              {product.salePrice && (
                <span class="text-lg text-neutral-500 line-through">
                  ${product.price.toFixed(2)}
                </span>
              )}
            </div>
            <p class="text-sm text-green-600">En stock: {product.stock} unidades</p>
          </div>

          <!-- Description -->
          <p class="text-neutral-700 mb-8">{product.description}</p>

          <!-- Options -->
          <div class="space-y-4 mb-8">
            {product.colors && (
              <div>
                <label class="block font-semibold mb-2">Color</label>
                <div class="flex gap-2">
                  {product.colors.map((color) => (
                    <button class="px-4 py-2 border border-neutral-300 rounded hover:border-primary-600">
                      {color}
                    </button>
                  ))}
                </div>
              </div>
            )}

            {product.sizes && (
              <div>
                <label class="block font-semibold mb-2">Talla</label>
                <div class="flex flex-wrap gap-2">
                  {product.sizes.map((size) => (
                    <button class="px-4 py-2 border border-neutral-300 rounded hover:border-primary-600">
                      {size}
                    </button>
                  ))}
                </div>
              </div>
            )}
          </div>

          <!-- Add to Cart -->
          <div class="flex gap-4 mb-8">
            <input
              type="number"
              min="1"
              max={product.stock}
              value="1"
              class="border border-neutral-300 rounded px-4 py-3 w-20"
            />
            <Button
              variant="primary"
              size="lg"
              class="flex-1 text-center"
            >
              Agregar al Carrito
            </Button>
          </div>

          <!-- Meta -->
          <div class="border-t pt-6 text-sm text-neutral-600">
            <p class="mb-2"><strong>SKU:</strong> {product.id}</p>
            <p class="mb-2"><strong>Categoría:</strong> {product.category}</p>
            <p><strong>Tags:</strong> {product.tags.join(', ')}</p>
          </div>
        </div>
      </div>

      <!-- Tabs -->
      <div class="mt-16 border-t pt-12">
        <div class="flex gap-8 mb-8 border-b">
          <button class="pb-4 border-b-2 border-primary-600 font-semibold">
            Descripción
          </button>
          <button class="pb-4 text-neutral-600 hover:text-neutral-900">
            Información Adicional
          </button>
          <button class="pb-4 text-neutral-600 hover:text-neutral-900">
            Reseñas
          </button>
        </div>

        <div>
          <h3 class="text-xl font-semibold mb-4">Descripción del Producto</h3>
          <p class="text-neutral-700 mb-4">{product.description}</p>
          <ul class="list-disc list-inside space-y-2 text-neutral-700">
            <li>Producto de alta calidad</li>
            <li>Múltiples opciones de color y talla</li>
            <li>Envío rápido disponible</li>
            <li>Garantía de satisfacción</li>
          </ul>
        </div>
      </div>

      <!-- Related Products -->
      <div class="mt-16 pt-12 border-t">
        <h2 class="text-2xl font-bold mb-8">Productos Relacionados</h2>
        <p class="text-neutral-600">Próximamente...</p>
      </div>
    </div>
  </section>
</BaseLayout>
